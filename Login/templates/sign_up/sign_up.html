{% load static %}
{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
  <head>
   
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Saflora — Sign Up</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.6.1/toastify.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.6.1/toastify.min.js"
      defer
    ></script>

    <style>
      :root {
        --bg-1: #f6fff8;
        --bg-2: #e6fff0;
        --accent-1: #1aa06a;
        --accent-2: #6bd39a;
        --muted: #6b6f76;
        --card: #ffffff;
        --glass: rgba(255, 255, 255, 0.6);
        --radius: 18px;
        --shadow: 0 8px 30px rgba(20, 40, 30, 0.08);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        background: linear-gradient(
          135deg,
          rgba(107, 211, 154, 0.19),
          rgba(26, 160, 106, 0.06)
        );
      }
      body {
        margin: 0;
        font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        color: #123;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 36px;
      }
      .container {
        width: 100%;
        max-width: 1100px;
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 32px;
        align-items: center;
      }
      .left {
        border-radius: 24px;
        min-height: 420px;
        display: flex;
        flex-direction: column;
        gap: 28px;
        align-items: center;
      }
      .brand {
        width: 120px;
        height: 120px;
        border-radius: 20px;
        background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 28px;
        box-shadow: 0 10px 30px rgba(26, 160, 106, 0.18);
        flex-shrink: 0;
      }
      .left-content {
        color: #0b3b2a;
      }
      .left-content p {
        margin: 0 0 18px 0;
        color: var(--muted);
        text-align: center;
        line-height: 1.45;
        max-width: 520px;
      }
      .features {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
      }
      .feature {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 10px 14px;
        font-weight: 600;
        color: #0a4b36;
        box-shadow: 0 6px 18px rgba(15, 40, 20, 0.04);
        font-size: 13px;
      }
      .shape {
        position: absolute;
        left: 8%;
        top: 6%;
        width: 260px;
        height: 260px;
        filter: blur(36px);
        opacity: 0.12;
        background: radial-gradient(
          circle at 30% 30%,
          var(--accent-2),
          var(--accent-1) 60%,
          transparent 70%
        );
        border-radius: 48%;
        transform: rotate(18deg);
        pointer-events: none;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0.8)
        );
        border-radius: var(--radius);
        padding: 34px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(6px);
        border: 1px solid rgba(20, 50, 30, 0.04);
      }
      .card h2 {
        margin: 0;
        font-size: 32px;
        color: #17ba81;
      }
      .card p {
        margin: 0 0 20px 0;
        color: var(--muted);
        font-size: 14px;
      }
      .form-row {
        margin-bottom: 14px;
      }
      .flex-row {
        display: flex;
        gap: 12px;
      }
      .input {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(246, 255, 248, 0.9);
        border-radius: 12px;
        padding: 10px 12px;
        border: 1px solid rgba(15, 40, 20, 0.06);
      }
      .input input,
      .input select {
        border: 0;
        outline: 0;
        font-size: 15px;
        background: transparent;
        width: 100%;
        color: #083523;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        padding: 12px 18px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        border: 0;
        background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
        color: white;
        box-shadow: 0 8px 24px rgba(26, 160, 106, 0.18);
        transition: transform 0.16s ease, box-shadow 0.16s ease;
      }
      .btn:active {
        transform: translateY(1px);
      }
      .signup {
        margin-top: 16px;
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: center;
      }
      .signup a {
        color: var(--accent-1);
        font-weight: 600;
        text-decoration: none;
      }
      @media (max-width: 980px) {
        .flex-row {
          flex-direction: column;
        }
        .container {
          grid-template-columns: 1fr;
          padding: 0;
        }
        .left {
          order: 2;
          margin-top: 6px;
        }
        .card {
          order: 1;
        }
        .left {
          min-height: 200px;
          padding: 22px;
        }
        .brand {
          width: 88px;
          height: 88px;
          font-size: 22px;
        }
      }

      /* Custom toast styles matching the Saflora brand */
      .toastify {
        font-family: "Poppins", sans-serif;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(20, 40, 30, 0.15);
        font-weight: 500;
        font-size: 15px;
      }
      .toastify.success {
        background: linear-gradient(135deg, #1aa06a, #6bd39a);
      }
      .toastify.error {
        background: linear-gradient(135deg, #dc2626, #ef4444);
      }
      .toastify.warning {
        background: linear-gradient(135deg, #f59e0b, #fbbf24);
      }
      .toastify.info {
        background: linear-gradient(135deg, #3b82f6, #60a5fa);
      }
    </style>
     <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="shape" aria-hidden="true"></div>
    <div class="container" role="main">
      <section class="left">
        <img
          style="width: 30%"
          src="{% static 'Login/images/saflora.png' %}"
          alt="Saflora Logo"
        />
        <div class="left-content">
          <p>
            Eco-friendly powder floor cleaner crafted in Nepal. Gentle on Floor,
            tough on dirt — Introducing clean and fresh solution for household
          </p>
          <div class="features" aria-hidden="true">
            <div class="feature">Affordable</div>
            <div class="feature">Cleaning Property</div>
            <div class="feature">Fresh herbal scent</div>
          </div>
        </div>
      </section>
      <aside class="card" aria-label="Sign Up form">
        <h2>Create Account</h2>
        <p>Sign up to start managing orders, products, and more</p>
        <form id="signupForm" autocomplete="on" novalidate method="POST">
          {% csrf_token %}
           Username 
          <div class="form-row">
            <div class="input">
              <input
                type="text"
                name="username"
                placeholder="Username"
                required
              />
            </div>
          </div>

           First & Last Name 
          <div class="form-row flex-row">
            <div class="input">
              <input
                type="text"
                name="firstname"
                placeholder="First Name"
                required
              />
            </div>
            <div class="input">
              <input
                type="text"
                name="lastname"
                placeholder="Last Name"
                required
              />
            </div>
          </div>

           Contact & Address 
          <div class="form-row flex-row">
            <div class="input">
              <input
                id="contactInput"
                type="text"
                name="contact"
                placeholder="Contact"
                required
              />
            </div>
            <div class="input">
              <input
                type="text"
                name="address"
                placeholder="Address"
                required
              />
            </div>
          </div>

          <p id="contactError" style="color: red" class="text-red-400 text-sm mt-2 opacity-0 transition-opacity duration-300"></p>

           Email 
          <div class="form-row">
            <div class="input">
              <input id="emailInput" type="email" name="email" placeholder="Email" required />
            </div>
            <p id="emailError" style="color: red" class="text-red-400 text-sm mt-2 opacity-0 transition-opacity duration-300"></p>
          </div>

           Password 
          <div class="form-row">
            <div class="input">
              <input
                id="passwordInput"
                type="password"
                name="password"
                placeholder="Password"
                required
                minlength="8"
              />
            </div>
          </div>

          <p id="passwordError" style="color: red" class="text-red-400 text-sm mt-2 opacity-0 transition-opacity duration-300"></p>
          <p id="passwordStrength" class="text-sm mt-1 text-gray-600"></p>

           Referral 
          <div class="form-row">
            <div class="input">
              <select id="referral" name="referral" required>
                <option value="" disabled selected>
                  Where did you hear about us?
                </option>
                <option value="friend">Friend</option>
                <option value="social">Social Media</option>
                <option value="ad">Advertisement</option>
                <option value="other">Other</option>
              </select>
              <input
                type="text"
                id="referralOther"
                name="referralOther"
                placeholder="Please specify"
                style="display: none; margin-top: 8px"
              />
            </div>
          </div>

          <div class="form-row">
          <button id="signupBtn" class="btn" type="submit" disabled>Sign Up</button>
          </div>
          <div class="signup">
            <div style="color: var(--muted)">Already have an account?</div>
            <a href='{% url "login:user_login" %}'>Log In</a>
          </div>
        </form>
      </aside>
    </div>
    <script>

      // Front-end validation: email, contact, password strength.
      const emailInput = document.getElementById('emailInput');
      const emailError = document.getElementById('emailError');
      const contactInput = document.getElementById('contactInput');
      const contactError = document.getElementById('contactError');
      const passwordInput = document.getElementById('passwordInput');
      const passwordError = document.getElementById('passwordError');
      const passwordStrength = document.getElementById('passwordStrength');
      const signupBtn = document.getElementById('signupBtn');

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      // Allow digits, spaces, +, -, parentheses. We'll normalize and check length between 7-15 digits
      const phoneDigitsRegex = /\d/g;

      function validateEmail() {
        const v = emailInput.value.trim();
        if (v === '') {
          emailError.textContent = 'Email is required.';
          emailError.classList.add('opacity-100');
          return false;
        }
        if (!emailRegex.test(v)) {
          emailError.textContent = 'Please enter a valid email address.';
          emailError.classList.add('opacity-100');
          return false;
        }
        emailError.classList.remove('opacity-100');
        return true;
      }

      function validateContact() {
        const v = contactInput.value.trim();
        if (v === '') {
          contactError.textContent = 'Contact is required.';
          contactError.classList.add('opacity-100');
          return false;
        }
        const digits = (v.match(phoneDigitsRegex) || []).join('');
        if (digits.length < 10) {
          contactError.textContent = 'Please enter a valid contact number (10digits).';
          contactError.classList.add('opacity-100');
          return false;
        }
        contactError.classList.remove('opacity-100');
        return true;
      }

      function checkPasswordStrength(pw) {
        const score = {
          length: pw.length >= 8,
          lower: /[a-z]/.test(pw),
          upper: /[A-Z]/.test(pw),
          number: /[0-9]/.test(pw),
          special: /[^A-Za-z0-9]/.test(pw)
        };
        const passed = Object.values(score).filter(Boolean).length;
        if (pw.length === 0) return { level: 'empty', passed };
        if (passed <= 2) return { level: 'weak', passed };
        if (passed === 3 || passed === 4) return { level: 'medium', passed };
        return { level: 'strong', passed };
      }

      function validatePassword() {
        const v = passwordInput.value;
        if (v === '') {
          passwordError.textContent = 'Password is required.';
          passwordError.classList.add('opacity-100');
          passwordStrength.textContent = '';
          return false;
        }
        if (v.length < 8) {
          passwordError.textContent = 'Password must be at least 8 characters.';
          passwordError.classList.add('opacity-100');
        } else {
          passwordError.classList.remove('opacity-100');
        }
        const strength = checkPasswordStrength(v);
        if (strength.level === 'empty') {
          passwordStrength.textContent = '';
        } else if (strength.level === 'weak') {
          passwordStrength.textContent = 'Strength: Weak (add uppercase, numbers or symbols)';
          passwordStrength.style.color = '#dc2626';
        } else if (strength.level === 'medium') {
          passwordStrength.textContent = 'Strength: Medium (add more variety for stronger password)';
          passwordStrength.style.color = '#f59e0b';
        } else {
          passwordStrength.textContent = 'Strength: Strong';
          passwordStrength.style.color = '#16a34a';
        }

        // Require at least 3 of the 5 checks and min length 8
        const ok = v.length >= 8 && strength.passed >= 3;
        if (!ok) {
          if (!passwordError.classList.contains('opacity-100')) {
            passwordError.textContent = 'Password should include upper, lower, numbers or symbols.';
            passwordError.classList.add('opacity-100');
          }
        } else {
          passwordError.classList.remove('opacity-100');
        }
        return ok;
      }

      function updateSignupState() {
        const valid = validateEmail() && validateContact() && validatePassword();
        signupBtn.disabled = !valid;
        if (signupBtn.disabled) {
          signupBtn.style.opacity = '0.6';
          signupBtn.style.cursor = 'not-allowed';
        } else {
          signupBtn.style.opacity = '1';
          signupBtn.style.cursor = 'pointer';
        }
      }

      [emailInput, contactInput, passwordInput].forEach(el => {
        el.addEventListener('input', updateSignupState);
        el.addEventListener('blur', updateSignupState);
      });

      // initialize state on load
      document.addEventListener('DOMContentLoaded', function() {
        updateSignupState();
      });

      // Prevent submit if validations fail (covers Enter key or direct submit attempts)
      const signupFormEl = document.getElementById('signupForm');
      signupFormEl.addEventListener('submit', function(e) {
        const valid = validateEmail() && validateContact() && validatePassword();
        if (!valid) {
          e.preventDefault();
          updateSignupState();
          if (typeof Toastify === 'function') {
            Toastify({
              text: 'Please fix form errors before signing up.',
              duration: 3000,
              close: true,
              gravity: 'top',
              position: 'right',
              className: 'warning'
            }).showToast();
          }
        }
      });

      // Display Django messages as toast notifications

      // might be error in here ! 
      {% if messages %}
        document.addEventListener('DOMContentLoaded', function() {
          {% for message in messages %}
            const messageLevel = '{{ message.tags }}';
            const messageText = '{{ message|escapejs }}';
            
            // Map Django message levels to toast styles
            let toastClass = 'info';
            if (messageLevel.includes('error') || messageLevel.includes('danger')) {
              toastClass = 'error';
            } else if (messageLevel.includes('success')) {
              toastClass = 'success';
            } else if (messageLevel.includes('warning')) {
              toastClass = 'warning';
            }
            
            // Show toast notification
            Toastify({
              text: messageText,
              duration: 4000,
              close: true,
              gravity: "top",
              position: "right",
              stopOnFocus: true,
              className: toastClass,
              offset: {
                x: 20,
                y: 20
              }
            }).showToast();
          {% endfor %}
        });
      {% endif %}

      // Handle referral dropdown "Other" option
      const referralSelect = document.getElementById('referral');
      const referralOther = document.getElementById('referralOther');
      
      referralSelect.addEventListener('change', function() {
        if (this.value === 'other') {
          referralOther.style.display = 'block';
          referralOther.required = true;
        } else {
          referralOther.style.display = 'none';
          referralOther.required = false;
        }
      });
    </script>
  </body>
</html>
