{% extends "base/notification.html" %}
{% load static %}
{% block title %} Sign-up {% endblock title %}

{% block content %}
    <!-- Page Title -->
    <title>Saflora — Sign Up</title>

    <!-- Add Tailwind & Poppins Font -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Custom Styles -->
    <style>
        * {
            font-family: 'Poppins', sans-serif;
        }
        .strength-weak { width: 33%; background-color: #ef4444; }
        .strength-fair { width: 66%; background-color: #f59e0b; }
        .strength-good { width: 100%; background-color: #3b82f6; }
        .strength-strong { width: 100%; background-color: #10b981; }
    </style>

    <!-- Main Content -->
    <div class="bg-gradient-to-br from-green-50 via-white to-emerald-50 min-h-screen flex items-center justify-center p-4 sm:p-6">
        <div class="w-full max-w-5xl">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">

                <!-- Left Section -->
                <section class="flex flex-col justify-center items-center lg:items-start text-center lg:text-left">
                    <div class="mb-6 lg:mb-8">
                        <img 
                            src="{% static 'Login/images/saflora.png' %}" 
                            alt="Saflora Logo"
                            class="w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 mx-auto lg:mx-0"
                        />
                    </div>
                    
                    <div class="space-y-4 lg:space-y-6">
                        <p class="text-gray-700 text-sm sm:text-base leading-relaxed max-w-sm">
                            Eco-friendly powder floor cleaner crafted in Nepal. Gentle on floors, tough on dirt — Introducing a clean and fresh solution for your household.
                        </p>
                        
                        <div class="flex flex-wrap gap-2 justify-center lg:justify-start">
                            <span class="bg-white px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium text-emerald-700 shadow-sm">Affordable</span>
                            <span class="bg-white px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium text-emerald-700 shadow-sm">Cleaning Power</span>
                            <span class="bg-white px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium text-emerald-700 shadow-sm">Fresh Herbal Scent</span>
                        </div>
                    </div>
                </section>

                <!-- Right Section - Form -->
                <aside class="bg-white bg-opacity-90 backdrop-blur-sm rounded-2xl shadow-lg p-6 sm:p-8 lg:p-10 border border-emerald-100">
                    <h2 class="text-2xl sm:text-3xl font-bold text-emerald-600 mb-2">Create Account</h2>
                    <p class="text-gray-600 text-sm sm:text-base mb-6">Sign up to start managing orders, products, and more</p>

                    <form method="POST" autocomplete="on" novalidate class="space-y-4">
                        {% csrf_token %}
                        
                        <!-- Username -->
                        <div>
                            <label for="username" class="block text-xs font-semibold text-gray-700 mb-2">Username *</label>
                            <input
                                type="text"
                                id="username"
                                name="username"
                                placeholder="Enter username"
                                required
                                class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            />
                            <p class="text-xs text-gray-500 mt-1">3-20 characters, letters and numbers only</p>
                        </div>

                        <!-- First & Last Name -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="firstname" class="block text-xs font-semibold text-gray-700 mb-2">First Name *</label>
                                <input
                                    type="text"
                                    id="firstname"
                                    name="firstname"
                                    placeholder="First name"
                                    required
                                    class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                                />
                            </div>
                            <div>
                                <label for="lastname" class="block text-xs font-semibold text-gray-700 mb-2">Last Name *</label>
                                <input
                                    type="text"
                                    id="lastname"
                                    name="lastname"
                                    placeholder="Last name"
                                    required
                                    class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                                />
                            </div>
                        </div>

                        <!-- Contact & Address -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="contact" class="block text-xs font-semibold text-gray-700 mb-2">Contact Number *</label>
                                <input
                                    type="text"
                                    id="contact"
                                    name="contact"
                                    placeholder="10-digit number"
                                    maxlength="10"
                                    required
                                    class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                                />
                                <div class="flex items-center justify-between mt-1">
                                    <p class="text-xs text-gray-500">Exactly 10 digits</p>
                                    <span id="contactCount" class="text-xs font-medium text-gray-500">0/10</span>
                                </div>
                                <p id="contactError" class="text-xs text-red-600 mt-1 hidden"></p>
                            </div>
                            <div>
                                <label for="address" class="block text-xs font-semibold text-gray-700 mb-2">Address *</label>
                                <input
                                    type="text"
                                    id="address"
                                    name="address"
                                    placeholder="Street address"
                                    required
                                    class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                                />
                            </div>
                        </div>

                        <!-- Email -->
                        <div>
                            <label for="email" class="block text-xs font-semibold text-gray-700 mb-2">Email Address *</label>
                            <input
                                type="email"
                                id="email"
                                name="email"
                                placeholder="your.email@example.com"
                                required
                                class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            />
                            <p id="emailError" class="text-xs text-red-600 mt-1 hidden"></p>
                        </div>

                        <!-- Password -->
                        <div>
                            <label for="password" class="block text-xs font-semibold text-gray-700 mb-2">Password *</label>
                            <input
                                type="password"
                                id="password"
                                name="password"
                                placeholder="Create a strong password"
                                required
                                minlength="8"
                                class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            />
                            
                            <!-- Password Strength Indicator -->
                            <div class="mt-3 space-y-2">
                                <div class="flex gap-1">
                                    <div id="strengthBar" class="h-2 bg-gray-200 rounded-full flex-grow"></div>
                                </div>
                                <p id="strengthText" class="text-xs font-medium text-gray-600">Password strength: Not checked</p>
                                <ul class="text-xs text-gray-600 space-y-1">
                                    <li id="requirement-length" class="flex items-center gap-2">
                                        <span id="icon-length" class="text-gray-400">✓</span> At least 8 characters
                                    </li>
                                    <li id="requirement-upper" class="flex items-center gap-2">
                                        <span id="icon-upper" class="text-gray-400">✓</span> One uppercase letter
                                    </li>
                                    <li id="requirement-lower" class="flex items-center gap-2">
                                        <span id="icon-lower" class="text-gray-400">✓</span> One lowercase letter
                                    </li>
                                    <li id="requirement-number" class="flex items-center gap-2">
                                        <span id="icon-number" class="text-gray-400">✓</span> One number
                                    </li>
                                    <li id="requirement-special" class="flex items-center gap-2">
                                        <span id="icon-special" class="text-gray-400">✓</span> One special character (@$!%*?&)
                                    </li>
                                </ul>
                            </div>
                            <p id="passwordError" class="text-xs text-red-600 mt-2 hidden"></p>
                        </div>

                        <!-- Referral -->
                        <div>
                            <label for="referral" class="block text-xs font-semibold text-gray-700 mb-2">How did you hear about us? *</label>
                            <select
                                id="referral"
                                name="referral"
                                required
                                class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            >
                                <option value="" disabled selected>Select an option</option>
                                <option value="friend">Friend</option>
                                <option value="social">Social Media</option>
                                <option value="ad">Advertisement</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Referral Other -->
                        <div id="referralOtherDiv" class="hidden">
                            <label for="referralOther" class="block text-xs font-semibold text-gray-700 mb-2">Please specify *</label>
                            <input
                                type="text"
                                id="referralOther"
                                name="referralOther"
                                placeholder="Tell us where you heard about us"
                                class="w-full px-4 py-2.5 bg-emerald-50 border border-emerald-200 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            />
                        </div>

                        <!-- Submit Button -->
                        <button
                            type="submit"
                            class="w-full mt-6 px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl hover:from-emerald-700 hover:to-teal-700 transition transform hover:scale-105 active:scale-95"
                        >
                            Create Account
                        </button>

                        <!-- Login Link -->
                        <div class="text-center text-sm text-gray-600 mt-4">
                            Already have an account?
                            <a href='{% url "login:user_login" %}' class="text-emerald-600 font-semibold hover:text-emerald-700 transition">
                                Log In
                            </a>
                        </div>
                    </form>
                </aside>
            </div>
        </div>
    </div>

    <!-- Validation & Real-time Feedback Script -->
    <script>
        // Contact Number Validation
        const contactInput = document.getElementById('contact');
        const contactCount = document.getElementById('contactCount');
        const contactError = document.getElementById('contactError');

        contactInput.addEventListener('input', function(e) {
            // Only allow digits
            this.value = this.value.replace(/\D/g, '');
            
            // Update counter
            contactCount.textContent = `${this.value.length}/10`;
            
            // Validate length
            if (this.value.length === 10) {
                contactInput.classList.remove('border-red-400');
                contactInput.classList.add('border-green-400', 'ring-2', 'ring-green-400', 'ring-opacity-50');
                contactError.classList.add('hidden');
            } else if (this.value.length > 0) {
                contactInput.classList.remove('border-green-400', 'ring-2', 'ring-green-400', 'ring-opacity-50');
                contactInput.classList.add('border-red-400');
                contactError.textContent = `Must be exactly 10 digits (${10 - this.value.length} remaining)`;
                contactError.classList.remove('hidden');
            } else {
                contactInput.classList.remove('border-green-400', 'border-red-400', 'ring-2', 'ring-green-400', 'ring-opacity-50');
                contactError.classList.add('hidden');
            }
        });

        // Email Validation
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('emailError');

        emailInput.addEventListener('blur', function() {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (this.value && !emailRegex.test(this.value)) {
                emailInput.classList.add('border-red-400');
                emailError.textContent = 'Please enter a valid email address';
                emailError.classList.remove('hidden');
            } else {
                emailInput.classList.remove('border-red-400');
                emailError.classList.add('hidden');
            }
        });

        emailInput.addEventListener('input', function() {
            if (this.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (emailRegex.test(this.value)) {
                    emailInput.classList.remove('border-red-400');
                    emailInput.classList.add('border-green-400');
                    emailError.classList.add('hidden');
                }
            }
        });

        // Password Strength Validation
        const passwordInput = document.getElementById('password');
        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');
        const passwordError = document.getElementById('passwordError');

        const requirements = {
            'length': { regex: /.{8,}/, icon: 'icon-length', text: 'At least 8 characters' },
            'upper': { regex: /[A-Z]/, icon: 'icon-upper', text: 'One uppercase letter' },
            'lower': { regex: /[a-z]/, icon: 'icon-lower', text: 'One lowercase letter' },
            'number': { regex: /\d/, icon: 'icon-number', text: 'One number' },
            'special': { regex: /[@$!%*?&]/, icon: 'icon-special', text: 'One special character' }
        };

        function updatePasswordStrength() {
            const password = passwordInput.value;
            let metRequirements = 0;

            // Check each requirement
            Object.keys(requirements).forEach(key => {
                const requirement = requirements[key];
                const isMet = requirement.regex.test(password);
                const icon = document.getElementById(requirement.icon);
                const reqElement = document.getElementById(`requirement-${key}`);

                if (isMet) {
                    metRequirements++;
                    icon.textContent = '✓';
                    icon.className = 'text-green-600 font-bold';
                    reqElement.classList.add('text-green-700');
                    reqElement.classList.remove('text-gray-600');
                } else {
                    icon.textContent = '✗';
                    icon.className = 'text-red-400';
                    reqElement.classList.remove('text-green-700');
                    reqElement.classList.add('text-gray-600');
                }
            });

            // Update strength bar and text
            strengthBar.innerHTML = '';
            let strength = 'Weak';
            let strengthClass = 'strength-weak';

            if (metRequirements === 5) {
                strength = 'Strong';
                strengthClass = 'strength-strong';
            } else if (metRequirements === 4) {
                strength = 'Good';
                strengthClass = 'strength-good';
            } else if (metRequirements >= 2) {
                strength = 'Fair';
                strengthClass = 'strength-fair';
            }

            const bar = document.createElement('div');
            bar.className = `${strengthClass} h-full rounded-full transition-all duration-300`;
            strengthBar.appendChild(bar);

            strengthText.textContent = password ? `Password strength: ${strength}` : 'Password strength: Not checked';

            // Show error if weak
            if (password && metRequirements < 5) {
                passwordError.classList.add('hidden');
            } else if (metRequirements === 5) {
                passwordError.classList.add('hidden');
            }
        }

        passwordInput.addEventListener('input', updatePasswordStrength);

        // Referral "Other" field visibility
        const referralSelect = document.getElementById('referral');
        const referralOtherDiv = document.getElementById('referralOtherDiv');
        const referralOtherInput = document.getElementById('referralOther');

        referralSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                referralOtherDiv.classList.remove('hidden');
                referralOtherInput.required = true;
            } else {
                referralOtherDiv.classList.add('hidden');
                referralOtherInput.required = false;
                referralOtherInput.value = '';
            }
        });

        // Form Validation on Submit
        const form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            let isValid = true;

            // Validate contact
            if (contactInput.value.length !== 10) {
                contactInput.classList.add('border-red-400');
                contactError.textContent = 'Contact number must be exactly 10 digits';
                contactError.classList.remove('hidden');
                isValid = false;
            }

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailInput.value)) {
                emailInput.classList.add('border-red-400');
                emailError.textContent = 'Please enter a valid email address';
                emailError.classList.remove('hidden');
                isValid = false;
            }

            // Validate password strength
            let metRequirements = 0;
            Object.keys(requirements).forEach(key => {
                if (requirements[key].regex.test(passwordInput.value)) {
                    metRequirements++;
                }
            });

            if (metRequirements < 5) {
                passwordInput.classList.add('border-red-400');
                passwordError.textContent = 'Password does not meet all requirements';
                passwordError.classList.remove('hidden');
                isValid = false;
            }

            if (!isValid) {
                e.preventDefault();
            }
        });
    </script>
{% endblock content %}