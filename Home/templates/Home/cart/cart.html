{% extends "Home/base/navbar.html" %}
{% load static %}
{% block title %} Cart {% endblock title %}

{% block extra_css %}  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Cart - Saflora</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
    body {
      font-family: "Inter", sans-serif;
      background-color: #f8f9fa;
    }
  </style>
{% endblock extra_css %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-6 md:py-12 px-4 md:px-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <h1 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">Your Cart</h1>

    <!-- Main Grid: Mobile stacks, Desktop side-by-side -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
      
      <!-- Left Side: Cart Items (Full width on mobile, 2/3 on desktop) -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
          
          <!-- Updated cart headers to show Product, Total, Buy, Delete -->
          <div class="hidden md:grid grid-cols-4 gap-4 text-xs uppercase text-gray-500 font-semibold mb-6 pb-4 border-b border-gray-200">
            <div class="col-span-2">Product</div>
            <div class="text-center">Total</div>
            <div class="text-right">Actions</div>
          </div>

          <!-- Cart Items Container -->
          
  
            
          
          <div id="cart-items-container" class="space-y-4 md:space-y-6">


          
          {% if carts %}
    {% for cart in carts %}
        {% if cart.item %}
        <!-- Cart Item -->
        <div class="cart-item border-b border-gray-200 pb-4 md:pb-6 last:border-b-0" data-cart-id="{{ cart.id }}">
            
            <!-- Mobile Layout -->
            <div class="md:hidden flex gap-4 mb-4">
                <div class="w-20 h-20 bg-gray-200 rounded-lg flex-shrink-0">
                    <img src="{{ cart.item.item_image.url }}" alt="Product" class="w-full h-full object-cover rounded-lg">
                </div>
                <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-base text-gray-900">{{ cart.item.item_name|default:"Product" }}</h3>
                    <p class="text-sm font-medium text-gray-900">Rs. <span class="unit-price" data-price="{{ cart.item.price|default:0 }}">{{ cart.item.price|default:0 }}</span></p>
                </div>
            </div>

            <!-- Mobile Actions -->
            <div class="md:hidden space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-gray-700">Total:</span>
                    <span class="font-semibold text-gray-900">Rs. <span class="item-total">{{ cart.item.price|default:0 }}</span></span>
                </div>
                <div class="flex gap-3">
                    <!-- Buy button -->
                    <form method="GET" action="{% url 'home:check_out_cart' cart.item.id cart.id %}" class="flex-1">
                        {% csrf_token %}
                        <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">
                            Buy
                        </button>
                    </form>
                    <!-- Delete button -->
                    <form method="POST" action='{% url "home:delete_cart" cart.id%}' class="flex-1">
                        {% csrf_token %}
                        <input type="hidden" name="cart_id" value="{{ cart.id }}">
                        <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">
                            Delete
                        </button>
                    </form>
                </div>
            </div>

            <!-- Desktop Layout -->
            <div class="hidden md:grid grid-cols-4 gap-4 items-center">
                <div class="col-span-2 flex items-center gap-4">
                    <div class="w-20 h-20 bg-gray-200 rounded-lg flex-shrink-0">
                        <img src="{{ cart.item.item_image.url }}" alt="Product" class="w-full h-full object-cover rounded-lg">
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900">{{ cart.item.item_name|default:"Product" }}</h3>
                        <p class="text-sm font-medium text-gray-900">Rs. <span class="unit-price" data-price="{{ cart.item.price|default:0 }}">{{ cart.item.price|default:0 }}</span></p>
                    </div>
                </div>
                <div class="flex items-center justify-center">
                    <span class="font-semibold text-gray-900">Rs. <span class="item-total">{{ cart.item.price|default:0 }}</span></span>
                </div>
                <div class="flex items-center justify-end gap-2">
                    <form method="GET" action="{% url 'home:check_out_cart' cart.item.id cart.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">
                            Buy
                        </button>
                    </form>
                    <form method="POST" action='{% url "home:delete_cart" cart.id%}' style="display: inline;" >
                        {% csrf_token %}
                        <input type="hidden" name="cart_id" value="{{ cart.id }}">
                        <button type="submit" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">
                            Delete
                        </button>
                    </form>
                </div>
            </div>

        </div>
        {% else %}
        <!-- Skip or display a warning if cart.item is missing -->
        <p class="text-red-500">Item missing for cart {{ cart.id }}.</p>
        {% endif %}
    {% endfor %}
{% else %}
<div id="empty-cart-message" class="text-center py-12">
    <i class="fas fa-shopping-cart text-gray-300 text-5xl mb-4"></i>
    <p class="text-gray-500 text-lg">Your cart is empty</p>
</div>
{% endif %}


          </div>

        </div>
      </div>

      {% comment %} <!-- Right Side: Order Summary (Sticky on desktop, below on mobile) -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 lg:sticky lg:top-6">
          <h2 class="text-2xl font-bold mb-6 text-gray-900">Order Summary</h2>

          <!-- Summary Details -->
          <div class="space-y-4 mb-6 pb-6 border-b border-gray-200">
            <div class="flex justify-between text-gray-700">
              <span>Subtotal</span>
              <span id="summary-subtotal" class="font-medium">Rs. 0.00</span>
            </div>
            <div class="flex justify-between text-gray-700">
              <span>Shipping</span>
              <span class="font-medium">Free</span>
            </div>
            <div class="flex justify-between text-gray-700">
              <span>Tax</span>
              <span id="summary-tax" class="font-medium">Rs. 0.00</span>
            </div>
          </div>

    

          <!-- Total -->
          <div class="flex justify-between items-center mb-6 pb-6 border-b border-gray-200">
            <span class="text-lg font-bold text-gray-900">Total</span>
            <span id="summary-total" class="text-2xl font-bold text-gray-900">Rs. 0.00</span>
          </div>

          <!-- Checkout Button -->
          <button class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors mb-4">
            Proceed to Checkout
          </button>

          <!-- Continue Shopping Link -->
          <a href="/" class="block w-full text-center border border-gray-300 hover:border-gray-400 text-gray-700 font-semibold py-2 px-4 rounded-lg transition-colors mb-4">
            Continue Shopping
          </a>

          <!-- Security Info -->
          <div class="bg-gray-50 p-4 rounded-lg text-center">
            <div class="flex items-center justify-center text-gray-600 mb-3">
              <i class="fas fa-lock mr-2"></i>
              <span class="text-sm font-medium">Secure SSL Checkout</span>
            </div>
            <!-- Payment Methods -->
            <div class="flex justify-center gap-3">
              <img src="https://img.icons8.com/color/40/000000/visa.png" alt="Visa" class="h-6 w-auto" />
              <img src="https://img.icons8.com/color/40/000000/mastercard.png" alt="Mastercard" class="h-6 w-auto" />
              <img src="https://img.icons8.com/color/40/000000/paypal.png" alt="PayPal" class="h-6 w-auto" />
            </div>
          </div>
        </div>
      </div> {% endcomment %}
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cartItemsContainer = document.getElementById("cart-items-container");
    const emptyCartMessage = document.getElementById("empty-cart-message");

    function updateAllTotals() {
      let subtotal = 0;
      const cartItems = document.querySelectorAll(".cart-item");

      if (cartItems.length === 0) {
        emptyCartMessage.classList.remove("hidden");
      } else {
        emptyCartMessage.classList.add("hidden");
      }

      cartItems.forEach((item) => {
        const unitPriceElement = item.querySelector(".unit-price");
        const itemTotalElement = item.querySelector(".item-total");

        if (unitPriceElement && itemTotalElement) {
          const unitPrice = parseFloat(unitPriceElement.dataset.price);
          itemTotalElement.textContent = unitPrice.toFixed(2);
          subtotal += unitPrice;
        }
      });

      // Update summary
      const summarySubtotal = document.getElementById("summary-subtotal");
      const summaryTax = document.getElementById("summary-tax");
      const summaryTotal = document.getElementById("summary-total");

      const tax = subtotal * 0.1; // 10% tax
      const total = subtotal + tax;

      summarySubtotal.textContent = `Rs. ${subtotal.toFixed(2)}`;
      summaryTax.textContent = `Rs. ${tax.toFixed(2)}`;
      summaryTotal.textContent = `Rs. ${total.toFixed(2)}`;
    }

    // Initial calculation
    updateAllTotals();
  });
</script>
{% endblock content %}
